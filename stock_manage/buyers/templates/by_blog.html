{% extends "by_base.html" %}
{% load static %}
{% block buyer_layout %}

		<style>
			.blog-thumbnail-img {
				width: 100%;
				height: 230px;
				object-fit: cover;
				border-radius: 8px;
				display: block;
			}
		</style>

		<!-- Start Hero Section -->
			<div class="hero">
				<div class="container">
					<div class="row justify-content-between">
						<div class="col-lg-5">
							<div class="intro-excerpt">
								<h1>Blog</h1>
								<p class="mb-4">Donec vitae odio quis nisl dapibus malesuada. Nullam ac aliquet velit. Aliquam vulputate velit imperdiet dolor tempor tristique.</p>
								<p><a href="" class="btn btn-secondary me-2">Shop Now</a><a href="#" class="btn btn-white-outline">Explore</a></p>
							</div>
						</div>
						<div class="col-lg-7">
							<div class="hero-img-wrap">
								<img src="{% static "images/couch.png" %}" class="img-fluid">
							</div>
						</div>
					</div>
				</div>
			</div>

		

		<div class="blog-section">
			<div class="container">
				
				
				<div class="row">
					{% for blog in blogs %}
					<div class="col-12 col-sm-6 col-md-4 mb-5" data-blog-id="{{ blog.id }}">
						<div class="post-entry">
							<a href="#" class="post-thumbnail">
								{% if blog.image %}
									<img src="{{ blog.image.url }}" alt="Image" class="img-fluid blog-thumbnail-img">
								{% else %}
									<img src="{% static "images/post-1.jpg" %}" alt="Image" class="img-fluid blog-thumbnail-img">
								{% endif %}
							</a>
							<div class="post-content-entry">
								<h3>
									<a href="#">
										{{ blog.des|truncatechars:40 }}
									</a>
								</h3>
								<div class="meta">
									<span>by <a href="#">{{ blog.by }}</a></span>
									<span>on <a href="#">{{ blog.date }}</a></span>
								</div>
							</div>
						</div>
					</div>
					{% empty %}
					<div class="col-12">
						<p class="text-center text-muted">No blogs available right now.</p>
					</div>
					{% endfor %}

				</div>
			</div>
		</div>


		

		

	<script>
	(function() {
		var rowEl = document.querySelector('.blog-section .container .row');
		if (!rowEl) return;
		var fallbackImage = "{% static 'images/post-1.jpg' %}";
		function truncateText(t, n) {
			if (!t) return '';
			return t.length > n ? t.slice(0, n - 1) + 'â€¦' : t;
		}
		var protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';
		var wsUrl = protocol + '://' + window.location.host + '/ws/blogs/';
		var socket = new WebSocket(wsUrl);
		socket.onmessage = function(e) {
			try {
				var msg = JSON.parse(e.data);
				if (msg && msg.type === 'blog_added' && msg.blog) {
					var b = msg.blog;
					var imgUrl = b.image_url || fallbackImage;
					var col = document.createElement('div');
					col.className = 'col-12 col-sm-6 col-md-4 mb-5';
					col.setAttribute('data-blog-id', b.id);
					col.innerHTML = '' +
						'<div class="post-entry">' +
							'<a href="#" class="post-thumbnail">' +
								'<img src="' + imgUrl + '" alt="Image" class="img-fluid blog-thumbnail-img">' +
							'</a>' +
							'<div class="post-content-entry">' +
								'<h3><a href="#">' + truncateText(b.des || '', 40) + '</a></h3>' +
								'<div class="meta">' +
									'<span>by <a href="#">' + (b.by || '') + '</a></span>' +
									'<span>on <a href="#">' + (b.date || '') + '</a></span>' +
								'</div>' +
							'</div>' +
						'</div>';
					rowEl.insertBefore(col, rowEl.firstChild);
				} else if (msg && msg.type === 'blog_updated' && msg.blog) {
					var b = msg.blog;
					var imgUrl = b.image_url || fallbackImage;
					var card = rowEl.querySelector('[data-blog-id=\"' + b.id + '\"]');
					if (card) {
						card.innerHTML = '' +
							'<div class="post-entry">' +
								'<a href="#" class="post-thumbnail">' +
									'<img src="' + imgUrl + '" alt="Image" class="img-fluid blog-thumbnail-img">' +
								'</a>' +
								'<div class="post-content-entry">' +
									'<h3><a href=\"#\">' + truncateText(b.des || '', 40) + '</a></h3>' +
									'<div class="meta">' +
										'<span>by <a href=\"#\">' + (b.by || '') + '</a></span>' +
										'<span>on <a href=\"#\">' + (b.date || '') + '</a></span>' +
									'</div>' +
								'</div>' +
							'</div>';
					}
				} else if (msg && msg.type === 'blog_deleted' && typeof msg.id !== 'undefined') {
					var card = rowEl.querySelector('[data-blog-id=\"' + msg.id + '\"]');
					if (card && card.parentElement) {
						card.parentElement.removeChild(card);
					}
				}
			} catch (_) {}
		};
	})();
	</script>

	{% endblock buyer_layout %}
